{% set title = "Audio Routing Patchbay" %}
{% extends "khplayer/base.html" %}

{% block head_add %}
<link rel="stylesheet" text="text/css" href="{{ url_for('.static', filename='patchbay.css')}}">
<script src="{{ url_for('.static', filename='leader-line/leader-line.min.js')}}"></script>
<script src="{{ url_for('.static', filename='patchbay.js')}}"></script>
{% endblock %}

{% macro render_node(node) %}
<div id="node-{{node.id}}" class="node" data-key="{{ node.name }}-{{ node.name_serial }}" style="{{node.style}}">
	<div class="node-name">{{ node.label }}</div>
	<div class="node-media-class">{{ node.media_class }}</div>
	<div class="node-body">
		<div class="node-inputs">
			{% for input in node.inputs %}
			<div id="port-{{input.id}}" class="port">{{ input.id }} {{ input.name }}</div>
			{% endfor %}
		</div>
		<div class="node-outputs">
			{% for output in node.outputs %}
			<div id="port-{{output.id}}" class="port">{{ output.name }} {{ output.id }}</div>
			{% endfor %}
		</div>
	</div>
</div>
{% endmacro %}

{% block main %}

<div id="patchbay" class="patchbay patchbay-loading">
{% for node in patchbay.nodes %}
{% if "Audio" in node.media_class %}
{{ render_node(node) }}
{% endif %}
{% endfor %}
</div>

<div id="dummy" style="position: absolute"></div>

<script>
var links = [
{% for link in patchbay.links %}
[{{link.output_port.id}}, {{link.input_port.id}}],
{% endfor %}
];
setTimeout(function() { init_patchbay(links) }, 100);
</script>

{% endblock %}

